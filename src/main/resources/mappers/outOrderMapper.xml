<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.modernhome.mapper.OutOrderMapper">

	<!-- 수주 불러오기 -->
		<select id="outOrderList" resultType="com.modernhome.domain.OutOrderJoinVO">
			SELECT oo_num, emp_name, clt_num, clt_name, pro_num, pro_name,
			oo_cnt, oo_start_date, oo_end_date, oo_state
			FROM out_order
			join employee e on out_order.emp_id = e.emp_id
			join client c on out_order.clt_id = c.clt_id
			join product p on out_order.pro_id = p.pro_id;
		</select>
	<!-- 수주 -->
		
	<!-- 수주 검색 -->
	<select id="outOrderListSearch" resultType="com.modernhome.domain.OutOrderJoinVO">
			SELECT oo_num, emp_name, clt_num, clt_name, pro_num, pro_name,
			oo_cnt, oo_start_date, oo_end_date, oo_state
			FROM out_order
			join employee e on out_order.emp_id = e.emp_id
			join client c on out_order.clt_id = c.clt_id
			join product p on out_order.pro_id = p.pro_id
		<where>
		<if test="clt_name != null">
			clt_name LIKE CONCAT('%', #{clt_name}, '%')
		</if>
		<if test="emp_name != null">
			AND emp_name LIKE CONCAT('%', #{emp_name}, '%') 
		</if>
		<if test="oo_start_date_1 != ''">
			AND oo_start_date &gt;= #{oo_start_date_1}
		</if>
		<if test="oo_start_date_2 != ''">
   	 		AND #{oo_start_date_2} &gt;= DATE(oo_start_date)
		</if>
		<if test="oo_end_date_1 != ''">
			AND oo_end_date &gt;= #{oo_end_date_1}
		</if>
		<if test="oo_end_date_2 != ''">
   	 		AND #{oo_end_date_2} &gt;= DATE(oo_end_date)
		</if>
		</where>
	</select>
	<!-- 수주 검색 -->
		
	<!-- 수주 등록 -->
	<insert id="regOutOrder">
		<selectKey keyProperty="oo_num" resultType="String" order="BEFORE">
			SELECT CONCAT('OO', LPAD(COALESCE(MAX(SUBSTR(oo_num, 3)), 0) + 1, 4, '0'))
			FROM out_order
		</selectKey>
	
	
		INSERT INTO out_order (oo_num, emp_id, clt_id, pro_id, oo_cnt, oo_start_date, oo_end_date)
		VALUES (#{oo_num}, #{emp_id}, #{clt_id}, #{pro_id}, #{oo_cnt},
		CASE WHEN #{oo_start_date} = '' THEN NULL ELSE #{oo_start_date} END,
		CASE WHEN #{oo_end_date} = '' THEN NULL ELSE #{oo_end_date} END)
	</insert>
	<!-- 수주 등록 -->
	
	<!-- 수주 삭제 -->
	<delete id="deleteOutOrder">
		DELETE FROM out_order WHERE oo_num = #{oo_num}
	</delete>
	<!-- 수주 삭제 -->
	
	

</mapper>